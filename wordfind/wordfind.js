const defaultDistribution={a:209614,b:49285,c:105029,d:84333,e:284526,f:30250,g:68224,h:66213,i:228274,j:4791,k:24652,l:139497,m:76024,n:178431,o:172692,p:75941,q:4439,r:180599,s:235404,t:168167,u:85126,v:25314,w:20459,x:7304,y:42738,z:13449};function getRandomLetters(t,n=Math.random,e=defaultDistribution){var r=Object.entries(e),a=Object.values(e).reduce((e,t)=>e+t,0),o=[];for(let e=0;e<t;e++){let e=n()*a;for(var d of r)if((e-=d[1])<0){o.push(d[0]);break}}return o}function getRandomIntInRangeInclusive(e,t,n=Math.random){return Math.floor(n()*(t-e+1))+e}function canFitWord(t,e,n,r){var a=[...e];for(let e=0;e<r.length;e++){if(null!=t[a[0]][a[1]]&&t[a[0]][a[1]]!=r[e])return!1;a[0]+=n[0],a[1]+=n[1]}return!0}function tryFitWord(t,e,n,r){var a=canFitWord(t,e,n,r);if(a){var o=[...e];for(let e=0;e<r.length;e++)t[o[0]][o[1]]=r[e],o[0]+=n[0],o[1]+=n[1]}return a}function generate(n,e,t,r=Math.random){for(var a of t)if(a.length>n&&a.length>e)return!1;var o,d=new Array(e).fill().map(()=>new Array(n).fill(null));for(o of t){var l=o.length<=e?[-1,0,1]:[0];const f=o.length<=n?[-1,0,1]:[0];var i,s=[];for(i of l.flatMap(t=>f.map(e=>[t,e])).filter(e=>!(0==e[0]&&0==e[1]))){var c=-1==i[0]?o.length-1:0,u=1==i[0]?e-o.length:e-1,h=-1==i[1]?o.length-1:0,p=1==i[1]?n-o.length:n-1,m=[];for(let t=c;t<=u;t++)for(let e=h;e<=p;e++)canFitWord(d,[t,e],i,o)&&m.push([[t,e],i]);0<m.length&&s.push(m)}if(0==s.length)return console.warn("cannot place word: "+o),!1;l=s[Math.floor(r()*s.length)],l=l[Math.floor(r()*l.length)];if(!tryFitWord(d,l[0],l[1],o))return console.error("pre-approved placement option failed"),!1}for(let t=0;t<e;t++)for(let e=0;e<n;e++)null==d[t][e]?d[t][e]=getRandomLetters(1,r)[0]:d[t][e]=d[t][e].toUpperCase();return d}function getCoords(t){const n=t.parentNode;var e=n.parentNode,r=[...n.children].findIndex(e=>e==t);return[[...e.children].findIndex(e=>e==n),r]}function handleClick(e){var e=e.target,t=e.parentNode.parentNode,n=[...t.querySelectorAll(".selected")];if(1<n.length)console.error("invalid state");else if(1==n.length&&n[0]!=e){var r=getCoords(n[0]),a=getCoords(e),o=a[0]-r[0],a=a[1]-r[1];if(Math.abs(o)==Math.abs(a)||0==o||0==a){var d=[Math.sign(o),Math.sign(a)],l=Math.max(Math.abs(o),Math.abs(a)),i=[];for(let e=0;e<=l;e++){var s=r[0]+d[0]*e,c=r[1]+d[1]*e;i.push(t.children[s].children[c])}const u=i.map(e=>e.innerText).join("").toUpperCase(),h=i.toReversed().map(e=>e.innerText).join("").toUpperCase();o=[...document.querySelectorAll(".target-word:not(.found)")].find(e=>e.innerText.toUpperCase()==u||e.innerText.toUpperCase()==h);n[0].classList.remove("selected"),o?(o.classList.add("found"),i.forEach(e=>e.classList.add("found"))):e.classList.add("selected")}else n[0].classList.remove("selected"),e.classList.add("selected")}else e.classList.toggle("selected")}function render(){var e=parseInt(document.getElementById("width").value)||10,t=parseInt(document.getElementById("height").value)||10,n=[...document.querySelectorAll(".input-word")].map(e=>e.innerText);var r,a,o,d,l=generate(e,t,n,(r=1732584193,a=4023233417,o=2562383102,d=271733878,function(){var e=a<<9,t=5*a;return d^=a,a^=o^=r,r^=d,o^=e,d=d<<11|d>>>21,(9*(t<<7|t>>>25)>>>0)/4294967296})),e={width:e,height:t,words:n.join(",")},t="?"+Object.entries(e).filter(e=>!!e[1]).map(e=>e[0]+"="+e[1]).join("&"),e=(history.replaceState(null,"",t),document.getElementById("container"));if(e.replaceChildren(),l){const i=document.createElement("table"),s=(i.className="matrix",l.forEach(e=>{const n=document.createElement("tr");e.forEach(e=>{var t=document.createElement("td");e==e.toUpperCase()&&(t.className="target"),t.addEventListener("click",handleClick),t.append(e.toUpperCase()),n.appendChild(t)}),i.appendChild(n)}),e.appendChild(i),document.createElement("div"));s.className="wordlist",n.sort((e,t)=>e.localeCompare(t)).forEach(e=>{var t=document.createElement("div");t.className="target-word",t.append(e.toUpperCase()),s.appendChild(t)}),e.appendChild(s),setShowSolution()}else{t=document.createElement("div");t.className="error",t.append("Failed to generate a valid wordfind, you may need to use a larger size to fit long words or a large number of words"),e.appendChild(t)}}function addWord(e){var t,n=document.getElementById("newword"),r=e||n.value;return 0!=r.length&&0!=(r=r.trim()).length&&(t=r.replaceAll(/[^a-z]/gi,""))==r&&(r=t.toLowerCase(),(t=document.createElement("div")).append(r),t.className="input-word",t.addEventListener("click",e=>{e.target.parentNode.removeChild(e.target),render()}),document.getElementById("input-words").appendChild(t),e||(n.value=""),!0)}function setShowSolution(){document.querySelectorAll(".matrix").forEach(e=>e.classList.toggle("show-solution",document.getElementById("show-solution").checked))}function init(){document.getElementById("addword").addEventListener("click",()=>addWord()&&render()),document.getElementById("newword").addEventListener("keyup",e=>13==e.keyCode&&addWord()&&render()),["width","height"].forEach(e=>document.getElementById(e).addEventListener("change",render)),document.getElementById("show-solution").addEventListener("change",setShowSolution);var e=Object.fromEntries(window.location.search.replace(/^\?/,"").split(/&/).map(e=>{e=/([^=]+)=?(.*)/.exec(e);return e?[e[1],e[2]]:null}).filter(e=>!!e));e.width&&(document.getElementById("width").value=e.width),e.height&&(document.getElementById("height").value=e.height),e.words&&e.words.split(/,/).forEach(addWord)}init(),render();
//# sourceMappingURL=wordfind.js.map